package ed448

import (
	. "gopkg.in/check.v1"
)

func (s *Ed448Suite) Test_DSASign_generatesCorrectSignature(c *C) {
	sym := [57]byte{
		0x3f,
	}
	msg := []byte{
		0x0A, 0x0C, 0x0B,
	}
	_, pub := deriveKeypair(sym)

	sig := DSASign(sym, pub, msg)

	c.Assert(sig[:], DeepEquals, []byte{
		0x7F, 0x26, 0xB2, 0x6D, 0x92, 0xB8, 0xCB, 0x20,
		0xD7, 0xA5, 0x59, 0x2D, 0xFE, 0x13, 0xC0, 0x15,
		0x77, 0x1D, 0xA2, 0xB3, 0x87, 0x14, 0x2F, 0x85,
		0x0D, 0xE7, 0x1C, 0x55, 0x03, 0xDB, 0xD7, 0x9D,
		0x02, 0x17, 0x8C, 0x25, 0x72, 0x85, 0x7C, 0x25,
		0x36, 0xE2, 0x06, 0xDF, 0xCA, 0xC5, 0x4B, 0x5A,
		0xA4, 0xC3, 0x61, 0xA3, 0xA2, 0x78, 0x4C, 0x97,
		0x00, 0x40, 0x07, 0xE3, 0x01, 0x85, 0xE8, 0xFB,
		0xBE, 0x4E, 0xE1, 0xD2, 0x02, 0x40, 0x14, 0x65,
		0x7F, 0x13, 0x29, 0x88, 0xA7, 0x62, 0xDF, 0x17,
		0x02, 0x4A, 0x86, 0x01, 0x6D, 0x51, 0x22, 0x50,
		0x1C, 0x58, 0xC4, 0x39, 0x67, 0x41, 0xEE, 0x67,
		0x87, 0x5C, 0xB4, 0x38, 0xFE, 0xED, 0x1F, 0x71,
		0x26, 0xE3, 0x3C, 0x8B, 0x6E, 0x7A, 0x26, 0xD0,
		0x1C, 0x00,
	})
}

func (s *Ed448Suite) Test_DSAVerify_verifiesACorrectSignature(c *C) {
	sig := [114]byte{
		0x7F, 0x26, 0xB2, 0x6D, 0x92, 0xB8, 0xCB, 0x20,
		0xD7, 0xA5, 0x59, 0x2D, 0xFE, 0x13, 0xC0, 0x15,
		0x77, 0x1D, 0xA2, 0xB3, 0x87, 0x14, 0x2F, 0x85,
		0x0D, 0xE7, 0x1C, 0x55, 0x03, 0xDB, 0xD7, 0x9D,
		0x02, 0x17, 0x8C, 0x25, 0x72, 0x85, 0x7C, 0x25,
		0x36, 0xE2, 0x06, 0xDF, 0xCA, 0xC5, 0x4B, 0x5A,
		0xA4, 0xC3, 0x61, 0xA3, 0xA2, 0x78, 0x4C, 0x97,
		0x00, 0x40, 0x07, 0xE3, 0x01, 0x85, 0xE8, 0xFB,
		0xBE, 0x4E, 0xE1, 0xD2, 0x02, 0x40, 0x14, 0x65,
		0x7F, 0x13, 0x29, 0x88, 0xA7, 0x62, 0xDF, 0x17,
		0x02, 0x4A, 0x86, 0x01, 0x6D, 0x51, 0x22, 0x50,
		0x1C, 0x58, 0xC4, 0x39, 0x67, 0x41, 0xEE, 0x67,
		0x87, 0x5C, 0xB4, 0x38, 0xFE, 0xED, 0x1F, 0x71,
		0x26, 0xE3, 0x3C, 0x8B, 0x6E, 0x7A, 0x26, 0xD0,
		0x1C, 0x00,
	}

	sym := [57]byte{
		0x3f,
	}
	msg := []byte{
		0x0A, 0x0C, 0x0B,
	}
	_, pub := deriveKeypair(sym)

	c.Assert(DSAVerify(sig, pub, msg), Equals, true)
}

func (s *Ed448Suite) Test_DSAVerify_doesntVerifyACorrectSignature_withWrongKey(c *C) {
	sig := [114]byte{
		0x7F, 0x26, 0xB2, 0x6D, 0x92, 0xB8, 0xCB, 0x20,
		0xD7, 0xA5, 0x59, 0x2D, 0xFE, 0x13, 0xC0, 0x15,
		0x77, 0x1D, 0xA2, 0xB3, 0x87, 0x14, 0x2F, 0x85,
		0x0D, 0xE7, 0x1C, 0x55, 0x03, 0xDB, 0xD7, 0x9D,
		0x02, 0x17, 0x8C, 0x25, 0x72, 0x85, 0x7C, 0x25,
		0x36, 0xE2, 0x06, 0xDF, 0xCA, 0xC5, 0x4B, 0x5A,
		0xA4, 0xC3, 0x61, 0xA3, 0xA2, 0x78, 0x4C, 0x97,
		0x00, 0x40, 0x07, 0xE3, 0x01, 0x85, 0xE8, 0xFB,
		0xBE, 0x4E, 0xE1, 0xD2, 0x02, 0x40, 0x14, 0x65,
		0x7F, 0x13, 0x29, 0x88, 0xA7, 0x62, 0xDF, 0x17,
		0x02, 0x4A, 0x86, 0x01, 0x6D, 0x51, 0x22, 0x50,
		0x1C, 0x58, 0xC4, 0x39, 0x67, 0x41, 0xEE, 0x67,
		0x87, 0x5C, 0xB4, 0x38, 0xFE, 0xED, 0x1F, 0x71,
		0x26, 0xE3, 0x3C, 0x8B, 0x6E, 0x7A, 0x26, 0xD0,
		0x1C, 0x00,
	}

	sym := [57]byte{
		0x4f,
	}
	msg := []byte{
		0x0A, 0x0C, 0x0B,
	}
	_, pub := deriveKeypair(sym)

	c.Assert(DSAVerify(sig, pub, msg), Equals, false)
}

func (s *Ed448Suite) Test_DSAVerify_doesntVerifyACorrectSignature_withWrongMessage(c *C) {
	sig := [114]byte{
		0x7F, 0x26, 0xB2, 0x6D, 0x92, 0xB8, 0xCB, 0x20,
		0xD7, 0xA5, 0x59, 0x2D, 0xFE, 0x13, 0xC0, 0x15,
		0x77, 0x1D, 0xA2, 0xB3, 0x87, 0x14, 0x2F, 0x85,
		0x0D, 0xE7, 0x1C, 0x55, 0x03, 0xDB, 0xD7, 0x9D,
		0x02, 0x17, 0x8C, 0x25, 0x72, 0x85, 0x7C, 0x25,
		0x36, 0xE2, 0x06, 0xDF, 0xCA, 0xC5, 0x4B, 0x5A,
		0xA4, 0xC3, 0x61, 0xA3, 0xA2, 0x78, 0x4C, 0x97,
		0x00, 0x40, 0x07, 0xE3, 0x01, 0x85, 0xE8, 0xFB,
		0xBE, 0x4E, 0xE1, 0xD2, 0x02, 0x40, 0x14, 0x65,
		0x7F, 0x13, 0x29, 0x88, 0xA7, 0x62, 0xDF, 0x17,
		0x02, 0x4A, 0x86, 0x01, 0x6D, 0x51, 0x22, 0x50,
		0x1C, 0x58, 0xC4, 0x39, 0x67, 0x41, 0xEE, 0x67,
		0x87, 0x5C, 0xB4, 0x38, 0xFE, 0xED, 0x1F, 0x71,
		0x26, 0xE3, 0x3C, 0x8B, 0x6E, 0x7A, 0x26, 0xD0,
		0x1C, 0x00,
	}

	sym := [57]byte{
		0x3f,
	}
	msg := []byte{
		0x42, 0x0C, 0x0B,
	}
	_, pub := deriveKeypair(sym)

	c.Assert(DSAVerify(sig, pub, msg), Equals, false)
}

func (s *Ed448Suite) Test_DSAVerify_doesntVerifyAnIncorrectSignature(c *C) {
	sig := [114]byte{
		0x42, 0x42, 0x42, 0x6D, 0x92, 0xB8, 0xCB, 0x20,
		0x42, 0xA5, 0x59, 0x2D, 0xFE, 0x13, 0xC0, 0x15,
		0x42, 0x1D, 0xA2, 0xB3, 0x87, 0x14, 0x2F, 0x85,
		0x0D, 0xE7, 0x1C, 0x55, 0x03, 0xDB, 0xD7, 0x9D,
		0x02, 0x17, 0x8C, 0x25, 0x72, 0x85, 0x7C, 0x25,
		0x36, 0xE2, 0x06, 0xDF, 0xCA, 0xC5, 0x4B, 0x5A,
		0xA4, 0xC3, 0x61, 0xA3, 0xA2, 0x78, 0x4C, 0x97,
		0x00, 0x40, 0x07, 0xE3, 0x01, 0x85, 0xE8, 0xFB,
		0xBE, 0x4E, 0xE1, 0xD2, 0x02, 0x40, 0x14, 0x65,
		0x7F, 0x13, 0x29, 0x88, 0xA7, 0x62, 0xDF, 0x17,
		0x02, 0x4A, 0x86, 0x01, 0x6D, 0x51, 0x22, 0x50,
		0x1C, 0x58, 0xC4, 0x39, 0x67, 0x41, 0xEE, 0x67,
		0x87, 0x5C, 0xB4, 0x38, 0xFE, 0xED, 0x1F, 0x71,
		0x26, 0xE3, 0x3C, 0x8B, 0x6E, 0x7A, 0x26, 0xD0,
		0x1C, 0x00,
	}

	sym := [57]byte{
		0x3f,
	}
	msg := []byte{
		0x0A, 0x0C, 0x0B,
	}
	_, pub := deriveKeypair(sym)

	c.Assert(DSAVerify(sig, pub, msg), Equals, false)
}

func (s *Ed448Suite) Test_DSASign_rfcTestVector1_noMsg(c *C) {
	_, pub := deriveKeypair(rfcTestVector1_sym)
	c.Assert(pub.DSAEncode(), DeepEquals, rfcTestVector1_expectedPub[:])
	sig := DSASign(rfcTestVector1_sym, pub, rfcTestVector1_msg)
	c.Assert(sig[:], DeepEquals, rfcTestVector1_sig)
}

func (s *Ed448Suite) Test_DSASign_rfcTestVector2_1oct(c *C) {
	_, pub := deriveKeypair(rfcTestVector2_sym)
	c.Assert(pub.DSAEncode(), DeepEquals, rfcTestVector2_expectedPub[:])
	sig := DSASign(rfcTestVector2_sym, pub, rfcTestVector2_msg)
	c.Assert(sig[:], DeepEquals, rfcTestVector2_sig)
}

func (s *Ed448Suite) Test_DSASign_rfcTestVector3_12oct(c *C) {
	_, pub := deriveKeypair(rfcTestVector3_sym)
	c.Assert(pub.DSAEncode(), DeepEquals, rfcTestVector3_expectedPub[:])
	sig := DSASign(rfcTestVector3_sym, pub, rfcTestVector3_msg)
	c.Assert(sig[:], DeepEquals, rfcTestVector3_sig)
}

func (s *Ed448Suite) Test_DSASign_rfcTestVector4_13oct(c *C) {
	_, pub := deriveKeypair(rfcTestVector4_sym)
	c.Assert(pub.DSAEncode(), DeepEquals, rfcTestVector4_expectedPub[:])
	sig := DSASign(rfcTestVector4_sym, pub, rfcTestVector4_msg)
	c.Assert(sig[:], DeepEquals, rfcTestVector4_sig)
}

func (s *Ed448Suite) Test_DSASign_rfcTestVector5_64oct(c *C) {
	_, pub := deriveKeypair(rfcTestVector5_sym)
	c.Assert(pub.DSAEncode(), DeepEquals, rfcTestVector5_expectedPub[:])
	sig := DSASign(rfcTestVector5_sym, pub, rfcTestVector5_msg)
	c.Assert(sig[:], DeepEquals, rfcTestVector5_sig)
}

func (s *Ed448Suite) Test_DSASign_rfcTestVector6_256oct(c *C) {
	_, pub := deriveKeypair(rfcTestVector6_sym)
	c.Assert(pub.DSAEncode(), DeepEquals, rfcTestVector6_expectedPub[:])
	sig := DSASign(rfcTestVector6_sym, pub, rfcTestVector6_msg)
	c.Assert(sig[:], DeepEquals, rfcTestVector6_sig)
}

func (s *Ed448Suite) Test_DSASign_rfcTestVector7_1023oct(c *C) {
	_, pub := deriveKeypair(rfcTestVector7_sym)
	c.Assert(pub.DSAEncode(), DeepEquals, rfcTestVector7_expectedPub[:])
	sig := DSASign(rfcTestVector7_sym, pub, rfcTestVector7_msg)
	c.Assert(sig[:], DeepEquals, rfcTestVector7_sig)
}
